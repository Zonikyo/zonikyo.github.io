<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Pterodactyl Multi-Panel Manager</title>
<style>
body { font-family: sans-serif; margin: 20px; background: #f5f5f5; }
input, button, select, textarea { padding: 8px; margin: 4px 0; width: 100%; }
#servers { margin-top: 20px; }
.server { border: 1px solid #ccc; padding: 10px; margin-bottom: 10px; background: #fff; }
button { cursor: pointer; }
textarea { height: 100px; }
</style>
</head>
<body>
<h2>Pterodactyl Multi-Panel Manager</h2>

<h3>Add API Panel</h3>
<input type="text" id="panelName" placeholder="Panel Name">
<input type="text" id="panelUrl" placeholder="Panel API URL (e.g. https://panel.com/api)">
<input type="text" id="panelKey" placeholder="API Key">
<button onclick="addPanel()">Add Panel</button>

<h3>Servers</h3>
<div id="servers"></div>

<script>
const workerUrl = "https://YOUR_CLOUDFLARE_WORKER.workers.dev/?=";
let panels = [];

function addPanel() {
  const name = document.getElementById('panelName').value;
  const url = document.getElementById('panelUrl').value;
  const key = document.getElementById('panelKey').value;
  if (!name || !url || !key) return alert("Fill all fields");

  panels.push({name, url, key});
  document.getElementById('panelName').value = '';
  document.getElementById('panelUrl').value = '';
  document.getElementById('panelKey').value = '';
  loadServers();
}

async function fetchWorker(apiKey, apiEndpoint, method="GET", body=null) {
  const encodedUrl = encodeURIComponent(`${apiKey}-${apiEndpoint}`);
  const options = { method };
  if (body) options.body = JSON.stringify(body);
  const res = await fetch(workerUrl + encodedUrl, options);
  return res.json();
}

async function loadServers() {
  const container = document.getElementById('servers');
  container.innerHTML = '';
  for (const panel of panels) {
    try {
      const data = await fetchWorker(panel.key, `${panel.url}/application/servers`);
      if (!data || !data.data) continue;
      data.data.forEach(server => {
        const div = document.createElement('div');
        div.className = "server";
        div.innerHTML = `<strong>${server.attributes.name}</strong> - ${panel.name}
        <br>Status: ${server.attributes.suspended ? "Suspended" : "Active"}
        <br>
        <button onclick="controlServer('${panel.key}','${panel.url}','${server.attributes.identifier}','start')">Start</button>
        <button onclick="controlServer('${panel.key}','${panel.url}','${server.attributes.identifier}','stop')">Stop</button>
        <button onclick="controlServer('${panel.key}','${panel.url}','${server.attributes.identifier}','restart')">Restart</button>
        <br>Console:
        <textarea id="console-${server.attributes.identifier}" placeholder="Console output"></textarea>
        <button onclick="sendConsole('${panel.key}','${panel.url}','${server.attributes.identifier}')">Send Command</button>
        `;
        container.appendChild(div);
      });
    } catch(e) { console.error(e); }
  }
}

async function controlServer(key, url, identifier, action) {
  try {
    await fetchWorker(key, `${url}/servers/${identifier}/power`, "POST", {signal: action});
    alert(`Server ${action} command sent`);
  } catch(e) { console.error(e); }
}

async function sendConsole(key, url, identifier) {
  const textarea = document.getElementById(`console-${identifier}`);
  const command = textarea.value.trim();
  if (!command) return alert("Enter a command");
  try {
    await fetchWorker(key, `${url}/servers/${identifier}/command`, "POST", {command});
    textarea.value = '';
    alert("Command sent");
  } catch(e) { console.error(e); }
}
</script>
</body>
</html>
